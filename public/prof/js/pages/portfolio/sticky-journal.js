function getFavoritesFromLocalStorage(){const stored=localStorage.getItem("journalIDs");if(!stored)return[];try{return JSON.parse(stored)}catch(e){return[]}}
function saveFavoritesToLocalStorage(idsArray){localStorage.setItem("journalIDs",JSON.stringify(idsArray))}
function toggleItemInArray(array,item){const index=array.indexOf(item);if(index===-1){array.push(item)}else{array.splice(index,1)}
return array}
function updateFavoritesUI(){const ids=getFavoritesFromLocalStorage();const linkElement=document.getElementById("journal-link");if(linkElement){const baseUrl=linkElement.dataset.baseUrl||window.location.origin+"/journal";const queryStr=ids.length>0?"?ids="+ids.join(","):"";linkElement.href=baseUrl+queryStr}
const counterElement=document.getElementById("journal-counter");if(counterElement){counterElement.textContent=ids.length}}
function toggleFavorite(postId){let current=getFavoritesFromLocalStorage();const wasAdded=!current.includes(postId);toggleItemInArray(current,postId);saveFavoritesToLocalStorage(current);updateFavoritesUI();if(wasAdded){const linkJournal=document.querySelector(".journal-rotate__shape");if(linkJournal){linkJournal.classList.add("rotate");setTimeout(()=>{linkJournal.classList.remove("rotate")},800)}}
return current}
function updateButtons(id,isFavorite){document.querySelectorAll(`[data-id="${id}"]`).forEach((button)=>{if(button.querySelector(".add-journal--text")){button.querySelector(".add-journal--text").textContent=isFavorite?"حذف از ژورنال":"افزودن به ژورنال"}
button.classList.toggle("added",isFavorite)})}
function initJournalButtons(){const currentFavorites=getFavoritesFromLocalStorage();const buttons=document.querySelectorAll(".add-journal--js");buttons.forEach((btn)=>{const id=btn.dataset.id;if(!id)return;updateButtons(id,currentFavorites.includes(id));btn.removeEventListener("click",handleJournalClick);btn.addEventListener("click",handleJournalClick)})}
function handleJournalClick(event){const btn=event.currentTarget;const id=btn.dataset.id;if(!id)return;const newFavorites=toggleFavorite(id);updateButtons(id,newFavorites.includes(id))}
function removeFromJournal(postId){let current=getFavoritesFromLocalStorage();const updatedFavorites=current.filter((id)=>id!==postId);saveFavoritesToLocalStorage(updatedFavorites);const url=new URL(window.location);const urlIds=url.searchParams.get("ids")?url.searchParams.get("ids").split(","):[];const updatedUrlIds=urlIds.filter((id)=>id!==postId);console.log(updatedUrlIds,urlIds);if(updatedUrlIds.length>0){url.search=`?ids=${updatedUrlIds.join(",")}`}else{url.searchParams.delete("ids")}
window.history.replaceState(null,"",url.toString());const cardElement=document.querySelector(`[data-id="${postId}"]`)?.closest(".card-js");if(cardElement){cardElement.remove()}}
document.addEventListener("DOMContentLoaded",()=>{document.querySelectorAll(".remove-journal--js").forEach((button)=>{button.addEventListener("click",function(){const postId=this.dataset.id;if(postId){removeFromJournal(postId)}})});updateFavoritesUI();initJournalButtons()});let dummy=document.createElement("input"),text=window.location.href;const copyBtn=document.querySelector(".copy-url");if(copyBtn){copyBtn.addEventListener("click",function(params){document.body.appendChild(dummy);dummy.value=text;dummy.select();document.execCommand("copy");document.body.removeChild(dummy);document.body.insertAdjacentHTML("afterend","<span class='copeid-alert hide'>آدرس صفحه کپی شد  </span>");setTimeout(()=>{document.querySelector(".copeid-alert").classList.remove("hide")},300);setTimeout(()=>{document.querySelector(".copeid-alert").classList.add("hide");document.querySelector(".copeid-alert").remove()},2000)})}
const footerEl=document.querySelector("#footer");const portfoliocols=document.querySelector(".portfolio-menu-wrapper");const stickyJournal=document.querySelector(".sticky-journal");let switchSticky=!0;if(footerEl&&stickyJournal){const addGradient=function(entries){const[entry]=entries;if(entry.isIntersecting){stickyJournal.classList.add("hide")}else{if(switchSticky)stickyJournal.classList.remove("hide")}};const footerObserver=new IntersectionObserver(addGradient,{root:null,threshold:0,});footerObserver.observe(footerEl)}
if(portfoliocols&&stickyJournal){const addGradient=function(entries){const[entry]=entries;if(entry.isIntersecting){stickyJournal.classList.remove("hide")}else{switchSticky=!1;stickyJournal.classList.add("hide")}};const footerObserver=new IntersectionObserver(addGradient,{root:null,threshold:0,});footerObserver.observe(portfoliocols)}